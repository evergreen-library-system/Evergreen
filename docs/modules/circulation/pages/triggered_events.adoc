= Triggered Events Log =
:toc:
indexterm:[events, notifications]

== Introduction ==
As of version 3.8, the Patron and Item Triggered Events Logs have been
reimplemented in Angular as well as given improvements in query
efficiency.

== Patron Triggered Events Log ==
[[patron_triggered_events_log]]

The Patron Triggered Events Log provides an interface where library
staff can view and sort triggered events and notifications associated
with circulations and holds on a patron’s account. This feature is often
used to identify if a notice, such as an overdue notice, was generated
by Evergreen for a patron. Entries remain in the Triggered Events Log
for a time period established in the Trigger Event Definition field
*Retention Interval*.

The Triggered Events Log can be accessed by retrieving a patron record
and selecting *Other → Triggered Events / Notifications*. As of 3.8,
this interface will open in a new browser tab. Future developments for
Evergreen may include integration with the existing patron account
interface. In order to view the Triggered Events Log, a staff member
will need the `VIEW_TRIGGER_EVENT` permission either directly or by a
group or profile membership.

image::triggered_events/patron_tel_location.png[Patron Triggered Events Log Location]

The Patron Triggered Events Log separates Hold Events and Circulation
Events into their own tabs.

image::triggered_events/patron_tel_tabs.png[Patron Tiggered Events Log Tabs]

The Circulation tab will display events such as predue notices, overdue
notices, and autorenewal notices, as well as events like Mark Item Lost
or Mark Item Long Overdue. The Hold tab will display events such as hold
notifications and curbside pickup offers. Both email and text/SMS
notification events that are generated by Evergreen will display in this
interface.

There are two available actions, *Cancel Selected Events* and *Reset
Selected Events*. Cancel will set an event to invalid and Reset will set
an event back to pending. Cancel does not check the current event state
so staff should use caution when using this action.

More information about the Notifications/Actions Triggers feature in
Evergreen, which generates patron notices, can be found xref:admin:actiontriggers.adoc[here].

image::triggered_events/patron_tel_display.png[Patron Triggered Events Log Display]

When retrieved from a patron record, the Triggered Event Log interface
shows only patron-related events, and only specific events that have
been scheduled or executed.

Filtering and sorting are available in the column headers. Filtering is
case-sensitive, and more information about how column filters work is
available xref:admin:staff_client-column_filters.adoc[here].

This interface displays the following columns for Circulation & Hold
Events. The default columns for display are note in _italics_:

* _Name_ - the name of the event
* _Reactor_ - the event’s Reactor, i.e., what action is carried out
* _Event Run Time_ - the time the event was run
* _Event State_ - the event state. Possible values include “complete”,
“pending”, or “error”
* _Context Library_ - the shortname of the library / Org Unit associated
with the event
* _Title_ - the title of the item associated with the event
* _Author_ - the author of the item associated with the event
* Patron Barcode - the barcode of the patron associated with the event
* Hook - what the Event “hooks” to in the fieldmapper; e.g., all predue
and overdue notices have a hook of *checkout.due* (due date)
* Event ID - the database Event ID
* Event Start Time - the time the Event started
* Event Update Time - the time the Event was updated
* Event Complete Time - the time the Event was completed
* Context User - the database ID of the user (i.e. patron) associated with
the event
* Context Item - the barcode of the item associated with the event
* Context Bib - the database ID of the bib record associated with the
event
* The columns Event Definition ID , Event Add Time, Event Update PID,
Event User Data, Event Template Output, Event Error Output, Event Target
Object ID, and Event Async Output are all fields that are only really
useful to Administrators & aren’t recommended for general end-users.

== Item Triggered Events Log ==
[[item_triggered_events_log]]

The Item Triggered Events Log displays the same information as the
Patron Triggered Events Log, but from the perspective of a specific
item. In order to view the Triggered Events Log, a staff member will
need the VIEW_TRIGGER_EVENT permission either directly or by a group or
profile membership. Entries remain in the Triggered Events Log for a
time period established in the Trigger Event Definition field *Retention
Interval*.

The Triggered Events Log can be accessed from the *Item Status*
interface (or any access point that invokes this interface). With a
single item selected in Item Status, navigate to *Detail View* and then
select the *Triggered Events* tab. This will open the rewritten
Triggered Events Log in a new browser tab. Alternatively, from either
the Item Status List View or Detail View, navigate to the *Actions Menu*
and select *Show Triggered Events*.

image::triggered_events/item_tel_location.png[Item Triggered Events Log Location]

The rewritten Triggered Events Log separates Hold Events and Circulation
Events into their own tabs.

image:triggered_events/item_tel_display.png[Item Triggered Events Log Display]

Circulation Events include predue notices, overdue notices, and
autorenewal notices as well as events like Mark Item Lost or Mark Item
Long Overdue. Hold Events include hold notifications and curbside pickup
offers. Circ and Holds notices can be sent via SMS or Email.

There are two available actions, *Cancel Selected Events* and *Reset
Selected Events*. Cancel will set an event to invalid and Reset will set
an event back to pending. Cancel does not check the current event state
so staff should use caution when using this action.

A full list of Events, including lists of Hooks, Reactors, and
Validators can be seen in the Admin interface *Notifications / Action
Triggers*. More information about Events can be seen xref:admin:actiontriggers.adoc[here].

Filtering and sorting are available in the column headers. Filtering is
case-sensitive, and more information about how column filters work is
available xref:admin:staff_client-column_filters.adoc[here].

Columns for Circulation & Hold Events (default columns in _italics_):

* _Patron Barcode_ - the barcode of the patron associated with the event
** Note that if the staff user doesn’t have appropriate VIEW_USER
permissions, they will see the database ID in this column.
* _Name_ - the name of the event
* _Reactor_ - the event’s Reactor, i.e., what action is carried out
* _Event Run Time_ - the time the event was run [note that there is an
existing Angular bug with datetime display]
* _Event State_ - the event state. Possible values include “complete”,
“pending”, or “error”
* _Title_ - the title of the item associated with the event
* _Author_ - the author of the item associated with the event
* Hook - what the Event “hooks” to in the fieldmapper; e.g., all predue
and overdue notices have a hook of *checkout.due* (due date)
* Event ID - the database Event ID
* Event Start Time - the time the Event started
* Event Update Time - the time the Event was updated
* Event Complete Time - the time the Event was completed
* Context User - the username or barcode of the user (i.e. patron)
associated with the event
** Note that if the staff user doesn’t have appropriate VIEW_USER
permissions, they will see the database ID in this column.
* Context Library - the database ID of the library / Org Unit associated
with the event
* Context Bib - the database ID of the bib record associated with the
event
* Context Item - the database ID of the item associated with the event
* The columns Event Definition ID , Event Add Time, Event Update PID,
Event User Data, Event Template Output, Event Error Output, Event Target
Object ID, and Event Async Output are all fields that are only really
useful to Administrators & aren’t recommended for general end-users.
