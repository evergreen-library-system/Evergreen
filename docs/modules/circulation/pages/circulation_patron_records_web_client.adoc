= Circulation - Patron Record = 
:toc:

[[searching_patrons]] 
== Searching Patrons ==

indexterm:[patrons, searching for]

To search for a patron, select _Search -> Search for Patrons_ from the menu bar.

The Patron Search screen will display. It will contain options to search on the 
following fields:

* Last Name 
* First Name 
* Middle Name 

image::circulation_patron_records_web_client/circulation_patron_records-1a_web_client.png[Screenshot of the collapsed form of the patron search. Shows the patron record tabs at the top and the fields Last Name, First Name, Middle Name. To the right of the fields are buttons for Search, Clear Form, and a down arrow icon.]


Next to the _Clear Form_ button there is a button with an arrow pointing down that will display the following additional search fields:
  
* Barcode 
* Alias 
* Username
* Email 
* Identification
* database ID
* Phone
* Street 1 
* Street 2 
* City 
* State 
* Postal Code
* Profile Group
* Home Library 
* DOB (date of birth) year
* DOB month
* DOB day

To include patrons marked ``inactive'', click on the _Include Inactive?_ checkbox.


image::circulation_patron_records_web_client/circulation_patron_records-1b_web_client.png[Screenshot of the expanded form of the patron search screen. The fields named above are displayed in a grid.]

.Tips for searching 
[TIP] 
=================== 
* Search one field or combine fields for more precise results. 
* Truncate search terms for more search results.
* Search ignores punctuation such as diacritics, apostrophes, hyphens and commas.
* Searching by Date of Birth: Year searches are "contains" searches. E.g. year
 "15" matches 2015, 1915, 1599, etc. For exact matches use the full 4-digit
 year. Day and month values are exact matches. E.g. month "1" (or "01") matches
 January, "12" matches December.
===================

Once you have located the desired patron, click on the entry row for this patron in
the results screen. A summary for this patron will display on the left hand side. 

image::circulation_patron_records_web_client/circulation_patron_records-2_web_client.png[Screenshot of the patron search results. The results are listed in a grid with each line representing a different patron account. One line is selected using the checkbox on the left and is highlighted. A summary of the account is displayed in a column on the left.]

The _Patron Search_ button on the upper right may be used to resume searching for patrons.

== Retrieve Recent Patrons ==

indexterm:[patrons, retrieving recent]

=== Setting up Retrieve Recent Patrons ===

* This feature must be configured in the _Library Settings Editor_
(_Administration -> Local Administration -> Library Settings Editor_). The
library setting is called "Number of Retrievable Recent Patrons" and is located
in the Circulation settings group.
** A value of zero (0) means no recent patrons can be retrieved.
** A value greater than 1 means staff will be able to retrieve multiple recent
patrons via a new _Circulation -> Retrieve Recent Patrons_ menu entry.
** The default value is 1 for backwards compatibility. (The _Circulation ->
Retrieve Last Patron_ menu entry will be available.)

=== Retrieving Recent Patrons ===
* Once the library setting has been configured to a number greater than 1, the
option Retrieve Recent Patrons will appear below the Retrieve Last patron
option in the Circulation drop-down from the Menu Bar (_Circulation ->
Retrieve Recent Patrons_).

* When selected, a grid will appear listing patrons accessed by that workstation
in the current session. The length of the list will be limited by the value
configured in the _Library Settings Editor_. If no patrons have been accessed,
the grid will display "No Items To Display."


== Registering New Patrons == 

indexterm:[patrons, registering]

To register a new patron, select _Circulation -> Register Patron_ from the menu bar. The Patron
Registration form will display. 

image::circulation_patron_records_web_client/circulation_patron_records-4.JPG[Screenshot of the top portion of the Patron registration form, All Fields view. Top left are the options to show; Required Fields, Suggested Fields, and All Fields. Top right are the Save and Save & Clone buttons. The majority of the screenshot focuses on the fields to be completed. The Barcode, OPAC/Staff Client User Name, First Name, and Last Name fields are all highlighted to indicate they are required.]

Mandatory fields display in yellow.

image::circulation_patron_records_web_client/circulation_patron_records-5.JPG[A zoomed in view of the same screenshot as above. The Barcode and OPAC/Staff Client User Name fields are highlighted]

The _Show: Required Fields_ and _Show: Suggested Fields_ links may be used to limit
the options on this page.

image::circulation_patron_records_web_client/circulation_patron_records-6.JPG[Another zoomed in view. This one has expanded slightly to include the Show options just above the Barcode field.]

When finished entering the necessary information, select _Save_ to save the new
patron record or _Save & Clone_ to register a patron with the same address.
When _Save & Clone_ is selected, the address information is copied into the
resulting patron registration screen. It is linked to the original patron.
Address information may only be edited through the original record.

image::circulation_patron_records_web_client/circulation_patron_records-8.JPG[A screenshot showing a lower section of the patron registration screen. This is focused on the address section. The Postal Code, Street (1), City, and Country fields are yellow to indicate they are required fields. An arrow has been added to highlight the location of the Save and Save & Clone buttons in the upper right.]

[TIP]
============================================================================
* Requested fields may be configured in the _Library Settings Editor_
(_Administration -> Local Administration -> Library Settings Editor_).
* Statistical categories may be created for information tracked by your library 
that is not in the default patron record.
* These may be configured in the _Statistical Categories Editor_
(_Administration -> Local Administration -> Statistical Categories Editor_).
* Staff accounts may also function as patron accounts.
* You must select a _Main (Profile) Permission Group_ before the _Update Expire
Date_ button will work, since the permission group determines the expiration date.
============================================================================

=== Photo URL field ===

As of 3.8, a staff user with the `UPDATE_USER_PHOTO_URL` permission can add or edit a URL that will pull in a patron photo image from an external server. Only https links are supported in this field.

Location of Photo URL field in the Patron Editor:

image::circulation_patron_records_web_client/patron_photo_url.png[A screenshot of a section of the patron registration page showing Secondary Identification Type, Secondary Identification, Photo URL, and Email Address. The Photo URL is highlighted and the URL used links out to a Wikimedia page.]

Enter the URL in that field and click **Save** at the top of the Patron Editor. The image indicated by the URL will display in the Patron Sidebar:

image::circulation_patron_records_web_client/patron_photo_sidebar.png[Screenshot of a photo in the patron account summary sidebar. At the top is the Patron name. Below is the photo (a photo of actress Hedy Lamar has been used) and below the photo we see the words Profile and Patrons.]

=== Email field ===

indexterm:[patrons,email addresses]
indexterm:[email]

It's possible for administrators to set up the email field to allow or disallow
multiple email addresses for a single patron (usually separated by a comma).
If you'd like to make changes to whether multiple email addresses
are allowed here or not, ask your system administrator to change the
`ui.patron.edit.au.email.regex` library setting.

=== Preferred Language field ===

As of 3.9 there is a Patron Preferred Language field in the Patron Registration and Patron Edit interfaces. This field contains a dropdown listing available locales for that Evergreen instance. Locales are configured in the `config.i18n_locales` table and you can use this feature to send action trigger messages in different languages.

For more information please see xref:admin:actiontriggers.adoc#creating_alternate_message_templates[Creating Alternate Message Templates].


== Patron Self-Registration ==

Patron Self-Registration allows patrons to initiate registration for a library account through the OPAC. Patrons can fill out a web-based form with basic information that will be stored as a “pending patron” in Evergreen. Library staff can review pending patrons in the staff-client and use the pre-loaded account information to create a full patron account. Pending patron accounts that are not approved within a configurable amount of time will be automatically deleted.

Please see the xref:admin:patron_self_registration.adoc[documentation on self-registration library settings] for information about how to enable and configure patron self-registration.

=== Patron Self-Registration ===

. In the OPAC, select the _Request a Library Card_ link. By default this is available in two places:
.. *My Account* on the upper right. 
+
image::circulation_patron_records_web_client/request_library_card.png[Link to request a library card]
+
.. In the center of the page's footer.
. In both cases, the link will take you to the self-registration form.
. Fill out the self-registration form to request a library card, and click *Submit Registration*.
+
image::circulation_patron_records_web_client/library_card_form.png[Self registration form]
+
. Patrons will see a confirmation message: “Registration successful! Please see library staff to complete your registration.”


=== Managing Pending Patrons ===

. In the staff client select *Circulation* -> *Pending Patrons*.

. Select the patron you would like to review. In this screen you have the option to *Load* the pending patron information to create a permanent library account.

. To create a permanent library account for the patron, click on the patron’s row, click on the *Load Patron* button at the top of the screen. This will load the patron self-registration information into the main *Patron Registration* form. 

. Fill in the necessary patron information for your library, and click *Save* to create the permanent patron account.


[[updating_patron_information]] 
== Updating Patron Information ==

indexterm:[patrons, updating]

Retrieve the patron record as described in the section
<<searching_patrons,Searching Patrons>>.

Click on _Edit_ from the options that display at the top of the patron record. 

image::circulation_patron_records_web_client/circulation_patron_records-9_web_client.png[Screenshot of a patron account for Sarah Smith. On the left is the summary display. The Edit tab has been selected at the top and all of the fields we saw on the patron registration screen can now be edited again. Replace Barcode and See All buttons are now visible next to the Barcode field.]

Edit information as required. When finished, select _Save_. 

After selecting _Save_, the page will refresh. The edited information will be
reflected in the patron summary pane.

[TIP]
=======
* To quickly renew an expired patron, click the _Update Expire Date_ button.
You will need a _Main (Profile) Permission Group_ selected for this to work,
since the permission group determines the expiration date.
=======

[[update_hold_notifications]]
=== Update Hold Notifications ===

indexterm:[patrons, holds, notifications]

The public catalog and staff client have the ability to update existing holds if a patron or a staff member changes certain notification preferences or contact information. Evergreen will detect these changes and prompt the staff user or patron user and ask if they want to update existing holds with the new contact information and/or notification preferences.

NOTE: Email notices are sent at the time of hold capture, the system will not prompt a user when a change to the email address is made - the user will only be prompted if email notifications are turned off or turned on, or if an email address is invalidated by a staff user.

[[update_hold_notifications_staffclient]]
==== Staff Client ====

In the web staff client, the staff user should retrieve a patron and select the *Edit* tab.

If the staff user makes any changes to the any of the following fields, when the staff user clicks *Save*, Evergreen will check if the patron has current unfulfilled holds.

* Daytime Phone
* Evening Phone
* Other Phone
* Default Phone Number
* Default Hold Pickup Location
* any of the Holds Notices checkboxes 

If unfulfilled holds are detected, the staff user will be prompted via a modal to update these holds with the new or updated contact information, or to remove contact information from the holds.

Select the desired holds to update by checking the box next to each different notification grouping and clicking *Update Holds*. The selected holds will be updated. If the user does not wish to update holds, click *Do Not Update Holds*.

image::circulation_patron_records_web_client/update_holds.png[A view of the Update Hold Notification Info? modal described above. The checkboxes next to the options are highlighted as is the Update Holds button.]

The Update Holds process will also be triggered if a phone number or email address is invalidated. Once the staff user clicks *Save* after invalidating a phone number or email address, Evergreen will check for unfulfilled holds and prompt for removing a notification method if necessary.

As part of this work, certain form validation constraints were added to the web client Patron Editor interface. These include the following:

* If the staff user sets the Holds Notices checkbox to true for Email Notify, Evergreen will enforce entry of a patron Email Address, if Email Address is blank.
* If the staff user sets the Holds Notices checkbox to true for Phone Notify, Evergreen * will enforce entry of a Default Phone Number, if Default Phone Number is blank.
* If the staff user sets the Holds Notices checkbox to true for SMS Notify, Evergreen will enforce entry of a Default SMS/Text Number, if the Default SMS/Text Number field is blank. * Additionally, even if the Holds Notices checkbox is false, if a staff user enters a number in the Default SMS/Text Number field, Evergreen will enforce a selection from the Default SMS Carrier dropdown.

[[update_hold_notifications_opac]]
==== Public Catalog ====

From the Public Catalog MyAccount interface, the patron user should navigate to the _Account Preferences_ tab and then to the _Notification Preferences_ tab. 

If the patron user makes any changes to any of the notification fields, when the patron user clicks *Save* Evergreen will check if the patron has current unfulfilled holds. 

If unfulfilled holds are detected, the patron user will be prompted via an interstitial page to update these holds with the new or updated contact information.

Select the desired holds to update by checking the box next to the each notification grouping and click *Update*. The selected holds will be updated. If the user does not wish to update holds, click *Continue without updating*.

image::circulation_patron_records_web_client/opac_update_holds.png[Screenshot of the public catalog My Account area for Account Information and Preferences. The check boxes for the update promptes and the Update button are highlighted.]

This work also added a _Notify Method_ column to the _Current Items on Hold_ table, found under the _Holds_ tab, that will show the patron user which notification methods are active, along with which numbers will be used for Phone or SMS notification. 

image::circulation_patron_records_web_client/notify_methods.png[A view of the public catalog My Account holds grid. One of the columns is highlighted. This is the Notify Method column. The example shows "Phone:410-000-1534"]

Additionally, patron users can now edit hold notification preferences on individual holds by using the _Edit_ function found in the _Current Items on Hold_ table.

image::circulation_patron_records_web_client/update_individual_hold.png[A screenshot of the Editing Hold page in the My Account section of the public catalog. The title information is above. As is status and hold queue position. The lower half of the shot is a grey box indicating the area that can be edited. There are fields for Pickup library, Cancel unless filled by, Active?, If suspended, activate on, email Notification, Phone Notification, SMS Notification, and Default Mobile Carrier. The last four fields have been highlighted.]
== Renewing Library Cards ==

indexterm:[library cards, renewing]

Expired patron accounts when initially retrieved – an alert
stating that the ``Patron account is EXPIRED.''

image::circulation_patron_records_web_client/circulation_patron_records-11_web_client.png[A screenshot of the alerts on a patron account. A small stop sign icon is first and then there are two light yellow banners with dark yellow text. The first is "Patron account is EXPIRED." The second alert alert banner reads, "Patron account has invalid addresses. Under all of this is a grey banner with black text that reads "Press a navigation button abouve (for example, Check Out) to clear this alert."]

Open the patron record in edit mode as described in the section
<<updating_patron_information,Updating Patron Information>>.

Navigate to the information field labeled _Privilege Expiration Date_. Enter a
new date in this box. Or click the calendar icon, and a calendar widget
will display to help you easily navigate to the desired date.

image::circulation_patron_records_web_client/circulation_patron_records-12.JPG[A screenshot of the patron registration page. The calendar widget for the Privilege Expiration Date has been opened and there is an arrow indicating the button for the widget between the field and the Update Expire Date button.]

Select the date using the calendar widget or key the date in manually. Click
the _Save_ button. The screen will refresh and the ``expired'' alerts on the
account will be removed. 


== Lost Library Cards ==

indexterm:[library cards, replacing]

Retrieve the patron record as described in the section
<<searching_patrons,Searching Patrons>>. 

Open the patron record in edit mode as described in the section
<<updating_patron_information,Updating Patron Information>>.
 
Next to the _Barcode_ field, select the _Replace Barcode_ button.

image::circulation_patron_records_web_client/replace_barcode_button.png[A screenshot of the top of the patron record screen. The Replace Barcode button next to the barcode field is highlighted., width=650]

This will clear the barcode field. Enter a new barcode and _Save_ the record.
The screen will refresh and the new barcode will display in the patron summary
pane. 

If a patron’s barcode is mistakenly replaced, the old barcode may be reinstated.
Retrieve the patron record as described in the section
<<searching_patrons,Searching Patrons>>. Open the patron record in
edit mode as described in the section <<updating_patron_information,Updating Patron Information>>.

Select the _See All_ button next to the _Replace Barcode_ button. This will
display the current and past barcodes associated with this account. 

image::circulation_patron_records_web_client/barcode_dialog.png[A screenshot of the Patron Barcodes modal. Two barcodes are shown. Under the Active heading, only the lower checkbox is selected. Under the Primary column the radio button for the second barcode is selected., width=650]

Check the box(es) for all barcodes that should be active for the patron. An
active barcode may be used for circulation transactions. A patron may have
more than one active barcode. Only one barcode may be designated
primary. The primary barcode displays in the patron’s summary
information in the _Library Card_ field. 

Once you have modified the patron barcode(s), _Save_ the patron record. If you
modified the ``primary'' barcode, the new primary barcode will display in the
patron summary screen. 

=== Deleting Patron Barcodes ===

indexterm:[library cards, deleting]

Patrons may accumulate multiple barcodes over time. Inactive barcodes can be deleted to keep the patron record clean and organized. Only inactive, non-primary barcodes can be deleted.

To delete a patron barcode:

. Retrieve the patron record as described in the section
<<searching_patrons,Searching Patrons>>.

. Open the patron record in edit mode as described in the section
<<updating_patron_information,Updating Patron Information>>.

. Select the _See All_ button next to the _Barcode_ field to open the Patron Barcodes dialog.

image::circulation_patron_records_web_client/barcode_deletion_dialog.png[Patron Barcodes dialog showing a table with barcode entries. The Delete column is visible with buttons for each barcode., width=650]

. Locate the barcode you wish to delete in the list.

. *Important:* Before deletion, the barcode must be:
   * Deactivated (uncheck the _Active_ checkbox)
   * The patron record must be saved and closed
   * The Patron Barcodes dialog must be reopened

. Once the barcode is confirmed as inactive and you have saved and reopened the dialog, the _Delete_ button for that barcode will become available (it appears grayed out for active barcodes).

. Click the _Delete_ button for the barcode to be removed.

image::circulation_patron_records_web_client/barcode_deletion_confirm.png[Patron Barcodes dialog showing a barcode marked for deletion with a "Pending Deletion" badge and grayed out in the list., width=650]

. A yellow alert banner labeled "Note:" will display indicating that "Barcode deletions will take effect when you save the patron record."

. Click _Apply Changes_ and then _Save_ the patron record. The barcode will be permanently deleted.

==== Deletion Requirements ====

[NOTE]
============================================================================
* The primary barcode cannot be deleted. You must change the primary barcode 
  to a different card before the current primary can be deleted.
* Active barcodes cannot be deleted. The barcode must first be deactivated 
  (uncheck _Active_) and the patron record must be saved before deletion is 
  permitted.
* Both the `UPDATE_PATRON_ACTIVE_CARD` and `UPDATE_PATRON_PRIMARY_CARD` 
  permissions are required to delete barcodes.
* Barcode deletions are not immediately applied. They take effect when you 
  save the patron record after clicking _Apply Changes_ in the Patron Barcodes 
  dialog.
============================================================================

== Resetting Patron's Password ==

indexterm:[patrons, passwords]

A patron’s password may be reset from the OPAC or through the staff client. To
reset the password from the staff client, retrieve the patron record as
described in the section <<searching_patrons,Searching Patrons>>. 

Open the patron record in edit mode as described in the section
<<updating_patron_information,Updating Patron Information>>.

Select the _Generate Password_ button next to the _Password_ field.

image::circulation_patron_records_web_client/circulation_patron_records_15.JPG[Screenshot of the top of the patron record. Just below the Replace Barcode button is the Generate Password button which is highlighted. The four digit password in the Password field to the left is also highlighted.]

NOTE: The existing password is not displayed in patron records for security
reasons.

A new number will populate the _Password_ text box.
Make note of the new password and _Save_ the patron record. The screen will
refresh and the new password will be suppressed from view.  


== Inactive Patron Accounts ==
When a patron account becomes "Inactive," a display alert is added to the account:

image::circulation_patron_records_web_client/inactive_alert.png[Account alert for inactive patron account]

Inactive patrons are prevented from logging into their account in the OPAC and checking out items. In the staff client, the checkout window is unusable, therefore, there is no option to override. The patron account must be marked "Active" before the patron is able to access their account and check out items.

To mark a patron "Active":

. Open the patron *Edit* screen.
. Select the *Active* checkbox.
+
image::circulation_patron_records_web_client/active_checkbox.png[Active checkbox on patron account]
+
. Click *Save*.

== Barring a Patron ==

indexterm:[patrons, barring]

A patron may be barred from circulation activities. To bar a patron:

. Retrieve the patron record as described in the section <<searching_patrons,Searching Patrons>>. 
. Open the patron record in edit mode as described in the section <<updating_patron_information,Updating Patron Information>>.
. Check the box for *Barred* in the patron account.
+
image::circulation_patron_records_web_client/circulation_patron_records-16.JPG[circulation_patron_records 16]
+
. *Save* the user. The screen will refresh. 


NOTE: Barring a patron from one library bars that patron from all consortium
member libraries. 

To unbar a patron, uncheck the *Barred* checkbox in the patron Edit screen and click *Save*.


== Barred vs. Blocked ==

indexterm:[patrons, barring]

*Barred*: When a patron account is marked as *Barred*, they are not able to log in to the OPAC or use their library card. If staff attempt a checkout, an alert appears notifying staff that the account is barred and providing an option to override the PATRON_BARRED event. Staff with the PATRON_BARRED.override permission can override the block.

image::circulation_patron_records_web_client/patron_barred_alert.png[Patron barred alert and override option]

indexterm:[patrons, blocking]

*Blocked*: Often, these are system-generated blocks on patron accounts. 

Some examples:

* Patron exceeds fine threshold 
* Patron exceeds max checked out item threshold

A notice appears when a staff person tries to checkout an item to blocked
patrons, but staff may be given permissions to override blocks.


== Consolidated Patron Notes, Alerts, Blocks, and Messages ==
[[staff_generated_messages]]
indexterm:[patrons, messages, notes, blocks, alerts]

Evergreen provides a variety of options for adding notifications to patron accounts. Notes, Alerts, Blocks, and Messages can all be applied to a patron account and managed in the Notes tab that is present in every account. It is also possible to add a custom Standing Penalty to a patron's account in the Notes tab.

The visibility and functionality of each option varies and can depend on the configuration of the Standing Penalty type.

=== Managing Notes, Alerts, and Blocks ===
[[managing_patron_notes]]

As with other patron functions, Notes, Alerts, and Blocks are controlled by the existing `UPDATE_USER` and `VIEW_USER` permissions. A staff member who has permissions to view or edit a user will be able to view and edit
notes for that user.

In the _Notes_ tab of a patron account, the top portion of the screen displays active notes, alerts, and blocks while the bottom portion of the screen will display those that have been archived. The archived notes, alerts, and blocks from the last year display by default. The calendar pickers can be used to view older archived notes, alerts, or blocks.

image::circulation_patron_records_web_client/notes_tab_full.png[A screenshot of the full notes tab. The Notes section at top has a typical grid view with the regualr actions and grid options buttons. To the left above the grid is the Create Note button. In the lower Archived Notes section there is another grid with the grid options buttons. Above this on the right are fields for Set Date Start and Set Date End.]

New notes, alerts, and blocks can be added by clicking the *Create Note* button. This process and the functionality of each type of notification are further detailed in this documentation. Library staff can Edit, Remove, and Archive notes, alerts, and blocks by selecting them from the list and then going to the Actions menu (you can also right-click on a selection to view the Actions menu).

* _Edit Note_ - allows staff to modify the original note, alert, or block
** Patron visible notes, alerts, and blocks that have been read by the patron cannot be edited by staff.
** When a note, alert, or block is edited, the note will retain the original context organizational unit instead of the current workstation library.
* _Remove Note_ - will permanently delete the note, alert, or block. There will not be a record of it on the patron account once it has been removed.
** Patron visible notes, alerts, and blocks that have been read by the patron cannot be deleted by staff.
* _Archive Note_ - will move the note, alert, or block to the Archived Notes section of the screen.
** Archiving a block will remove the block from the patron account.
** Once archived, notes, alerts, and blocks cannot be deleted from the _Notes_ tab. Archived patron visible notes will continue to display in the patron's OPAC account. To remove a patron visible note, un-archive the note and then remove the note.

image::circulation_patron_records_web_client/actions_menu.png[Notes Actions Menu expanded to show the three options described above.]

=== Notes ===
[[patron_notes]]

Notes can be added to patron accounts. Notes can be visible in the patron OPAC account or they can be visible only to library staff.

==== Note Display ====

When a note is present on a patron account, staff will see a counter on the tab ribbon that indicates how many un-archived notes, alerts, and blocks are on the account that are visible at the workstation at which the staff member is logged in. To view the note, click on the _Notes_ tab.

image::circulation_patron_records_web_client/notes_counter.png[Screenshot of the top of the Patron Account. The counter is a number inside of parentheses after the Tab name. So the tab reads "Notes (1)"]

The Notes tab contains a list of all of the notes, alerts, and blocks present on a patron’s account. The top portion of the screen displays active notes, alerts, and blocks, while the bottom portion of the screen will display those that have been archived within the past year (by default). Notes only appear in the _Notes_ tab, whereas Alerts and Messages can appear elsewhere.

==== Create a Note ====

To create a new Note:

. Go to the _Notes_ tab in the patron account and click *Create Note*.
. A modal will appear where you can create a new Note. Required fields are highlighted in yellow.
. Select _Note_ at the top of the screen.
. Check the box next to _Patron Visible_ for a note that will display in the patron’s OPAC account. Leave it unchecked to create a note that is staff visible only.
. The _Depth_ drop down menu controls the visibility of the note. Values correspond to OPAC labels, and by default they are This Branch, Local Library System, and Everywhere.
.. By default, the Location will be set to the library the staff member’s workstation is registered to. The note will be visible to the workstation library, as well as all organizational units that are ancestors and descendants in the organizational unit hierarchy.
. Enter a title or subject for the note in the _Title…_ field. The title field is required.
. Enter the main content of the note in the _Note Text…_ field.
. Enter your initials if your library requires initials when creating notes on patron accounts.
. Click *OK* to create the note.

image::circulation_patron_records_web_client/note_modal.png[A screenshot of the Note Modal. The fields are as described above. Only the Title field is highlighted yellow to indicate a required field.]

==== Messages ====
[[patron_messages]]

When a patron visible Note is created on an account, Evergreen automatically creates a message that then displays in the patron’s OPAC account. The original Note can be viewed in the Notes tab.

Staff can double click on a note to view the full title and content of the note. The notes grid can display the date and time the note was created and edited, as well as the date and time that the message was read. Staff can also see if a patron has deleted the message from their OPAC account in the _Deleted?_ column.

NOTE: Removing a message from this interface will remove it from the patron's view regardless of whether or not the note has been read. Removing an unread note should be done with caution.


==== Viewing Messages in the OPAC ====

Patrons will see a tab for Messages in their OPAC account, as well as a notification of Unread Messages in the account summary.

Unread messages display in bold font. Click on the subject of the message to view the full message.

image::circulation_patron_records_web_client/myaccount_boopac.png[Screenshot of Messages in the patron My Account area. There is a red number one at the top of the screen next to Messages. In the My Account menu on the left of the screen the Messges tab is selected and has an one next to it. The main portion of the screen is open to the Messages page and is showing a grid view with one example message. The Message line is bold. The buttons above the grid are Mark Read, Mark Unread, and Delete. ]

=== Alerts ===
[[patron_alerts]]

Alerts can be applied to patron accounts to notify library staff when the patron account is retrieved. Alerts can be visible in the patron OPAC account or they can be visible only to library staff. For versions 3.7 and prior, Alert Messages are only visible to staff and are created and edited from the Patron Edit interface.

==== Alerts Display ====

When an alert is present on a patron account, a Stop sign and the alert text is displayed when the patron account is viewed. The alert title also displays in the patron account summary on the left hand side of the screen and there is an indicator in the patron summary that indicates how many un-archived notes, alerts, and blocks are on the account that are visible at the workstation at which the staff member is logged in. Alerts can also be displayed by going to _Other -> Display Alerts_.

image::circulation_patron_records_web_client/stopsign_alert.png[A screenshot of the alert described above. The alert note text is shown in a banner across the screen with the word Alerts shown in a light yellow box with dark yellow text. The contents of the note are black text on a white background.]

==== Create an Alert ====

To create a new Alert:

. Go to the _Notes_ tab in the patron account and click *Create Note*.
. A modal will appear where you can create a new Alert. Required fields are highlighted in yellow.
. Select _Alert_ at the top of the screen.
. The _Depth_ drop down menu controls the visibility of the note. Values correspond to OPAC labels, and by default they are This Branch, Local Library System, and Everywhere.
.. By default, the Location will be set to the library the staff member’s workstation is registered to. The note will be visible to the workstation library, as well as all organizational units that are ancestors and descendants in the organizational unit hierarchy.
. Enter a title or subject for the alert in the _Title…_ field. The Title field is required.
. Enter the main content of the alert te in the _Note Text…_ field.
. Enter your initials if your library requires initials when creating alerts on patron accounts.
. Click *OK* to create the alert.

image::circulation_patron_records_web_client/alert_note.png[A screenshot of the Alert Modal. The fields are as described above. Only the Title field is highlighted yellow to indicate a required field.]

=== Blocks ===
[[patron_blocks]]

Blocks can be manually added to a patron account to take away certain library privileges from the patron for as long as the block remains on the account. The following privileges can be blocked on patron accounts as determined by configuration in the _Standing Penalties_ interface in the _Local Administration_ menu.

* CIRC - Users cannot check out items
* HOLD - Users cannot place holds on items
* RENEW - Users cannot renew items
* CAPTURE - This penalty prevents a user’s holds from being captured. If the HOLD penalty has not been applied to a user’s account, then the patron can place a hold, but the targeted item will not appear on a pull list and will not be captured for a hold if it is checked in.
* FULFILL - This penalty prevents a user from checking out an item that is on hold. If the HOLD and CAPTURE penalties have not been applied to a user’s account, then the user can place a hold on an item, and the itemcan be captured for a hold. However, when he tries to check out the item, the circulator will see a pop up box with the name of the penalty type, FULFILL. The circulator must correct the problem with the account or must override the penalty to check out the item.

==== Block Display ====

When a block is present on a patron account, a Stop sign and the block text is displayed when the patron account is viewed. The block title also displays in the patron account summary on the left hand side of the screen and there is an indicator in the patron summary that indicates how many un-archived notes, alerts, and blocks are on the account that are visible at the workstation at which the staff member is logged in. Blocks can also be displayed by going to _Other -> Display Alerts_.

image::circulation_patron_records_web_client/stopsign_block.png[A screenshot of the block described above. The alert note text is shown in a banner across the screen with the word Alerts shown in a light yellow box with dark yellow text. The contents of the note are black text on a white background.]

==== Create a Block ====

To create a new Block:

. Go to the _Notes_ tab in the patron account and click *Create Note*.
. A modal will appear where you can create a new Block. Required fields are highlighted in yellow.
. Select _Block_ at the top of the screen.
.. The default Block is a block on CIRC, HOLD, RENEW
.. Other Penalty Types can be selected from the drop down menu. These Penalty Types are configured in _Local Administration -> Standing Penalties_.
. The _Depth_ drop down menu controls the visibility of the note. Values correspond to OPAC labels, and by default they are This Branch, Local Library System, and Everywhere.
.. By default, the Location will be set to the library the staff member’s workstation is registered to. The note will be visible to the workstation library, as well as all organizational units that are ancestors and descendants in the organizational unit hierarchy.
. Enter a title or subject for the alert in the _Title…_ field. The Title field is required.
. Enter the main content of the block in the _Note…_ field.
. Enter your initials if your library requires initials when creating blocks on patron accounts.
. Click *OK* to create the block.

image::circulation_patron_records_web_client/block.png[Screenshot of the Block Display version of the note modal. The only difference from the alert type is the Block tab is selected and the Penalty Type is changed to Alerting block on Circ, Hold and...]

=== Administration for Patron Notes, Alerts, Blocks, and Messages ===
[[patron_notes_admin]]

==== Library Settings ====

Library Settings are found under _Administration -> Local Administration -> Library Settings Editor_. There is one new Library Setting related to patron notes in Evergreen:

* GUI: Require staff initials for entry/edit of patron standing penalties and notes

[NOTE]
==========
This Library Setting replaces two previous settings:

* Require staff initials for entry/edit of standing penalties and messages
* Require staff initials for entry/edit of patron notes
========== 

Values from these deprecated settings will be migrated to the new setting via the upgrade script.

If a value was set for “Require staff initials for entry/edit of standing penalties and messages”, that value will be the new value for the new Library Setting.

If there was no value set for “Require staff initials for entry/edit of standing penalties and messages”, but there was a value for “Require staff initials for entry/edit of patron notes”, then the value from the
legacy “patron notes” setting will be the value for the new Library
Setting.

If two different values are set for the legacy settings, the value from
the legacy “standing penalties and messages” setting will become the
value for the new Library Setting and the “patron notes” value will be
recorded in a text file as part of the upgrade script.

== Merging Patrons ==
indexterm:[patrons, merging]

Occasionally you may encounter a case where a patron has more than one account
in the system. This most commonly occurs when a new library system has joined a
consortium. It is possible to merge the patron accounts together and retain most
of the data from both records. 

[WARNING]
====
Merging patron accounts is not reversible. 
Make sure that the accounts are truly duplicates before you merge.
====

Merge Two Patron Accounts:

. Do a patron search; *Search -> Search for Patrons*.

. In the patron search results, check the two patron records that need to be merged.

. Select the *Merge Patrons* button.

+
image::circulation_patron_records_web_client/patron_merge_button.png[Screenshot of patron search results. In-line with the grid view actions button is a button labeled Merge Patrons.]
+

. A new pop-up will open to display the two records side by side for comparative
purposes. Select *Use as lead* on the account that should be the primary account
after the merge.

. Select *Merge* at the bottom of the screen.

. Evergreen will merge the two accounts and then return to the patron search screen.

[NOTE]
=====================
Post-Merge Data:

The configuration of your library settings will determine if barcodes are
retained or stay active. Your settings will also retain or delete the patron’s
addresses. Information from the subordinate account like checkouts, statistics,
notes, holds, and fines will be moved to the lead account.

If one of the patron accounts was barred, that information will only be retained
if the barred status was on the lead account. If the subordinate account was
barred, and you wish to retain that status, you will need to go in and reapply
the barred status on the newly merged account. 

If the subordinate account was in a patron group, that group connection will
not be retained on the merged account. Group membership will be retained if the
lead account was the group member.
=====================

=== Patron Merge Permissions and Settings ===

The ability to merge patron accounds is controlled by the permission, 'MERGE_USERS'.

There are four Library Settings involved in data retention and behavior during
a patron merge. For discussion of how to edit settings see the 
xref:admin:librarysettings.adoc#_editing_library_settings[Library Settings Editor].

* _Patron Merge Address Delete_ - Delete address(es) of subordinate user(s) in a
patron merge.

** When set to "True," only the addresses of the lead record are retained when
merging patrons. Addresses from the merged patron record are deleted.

** If set to “False,” both addresses are retained. You can manually set retained
addresses as inactive or delete them using the X button next to the address.

* _Patron Merge Barcode Delete_ - Delete barcode(s) of subordinate user(s) in a
patron merge.

** When set to "True," only the barcode(s) from the lead record are retained when
merging patrons. Barcodes from the merged patron records are deleted.

* _Patron Merge Deactivate Card_ - Mark barcode(s) of subordinate user(s) in a
patron merge as inactive.

** When set to "True," only the barcode of the lead record remains active when
merging patrons. Barcodes from the merged patron record are deactivated if not
deleted by the setting for Patron Merge Barcode Delete.

** If barcodes from both are retained, they can be found on the patron record by
clicking on the See All button next to the barcode field. If the inactive barcode
is used, Evergreen will provide an alert and will not allow checkouts without
acknowledgement of the issue.

* _Cloned patrons get address copy_ - In the Patron editor, copy addresses from the
cloned user instead of linking directly to the address.

** This setting will not control the ability to merge accounts regardless of if
the account is group lead or not. There will be no alert.

== User Buckets ==

User Buckets allow staff to batch delete and make batch modifications to user accounts in Evergreen. Batch modifications can be made to selected fields in the patron account:

* Home Library
* Profile Group
* Network Access Level
* Barred flag
* Active flag
* Juvenile flag
* Privilege Expiration Date
* Statistical Categories

Batch modifications and deletions can be rolled back or reversed, with the exception of batch changes to statistical categories. Batch changes made in User Buckets will not activate any Action/Trigger event definitions that would normally be activated when editing an individual account.

User accounts can be added to User Buckets by scanning individual user barcodes or by uploading a file of user barcodes directly in the User Bucket interface. They can also be added to a User Bucket from the Patron Search screen. Batch changes and batch edit sets are tied to the User Bucket itself, not to the login of the bucket owner.

=== Create a User Bucket ===

*To add users to a bucket via the Patron Search screen:*

. Go to *Search->Search for Patrons*.
. Enter your search and select the users you want to add to the user bucket by checking the box next to each user row. You can also hold down the CTRL or SHIFT on your keyboard and select multiple users.
. Click *Add to Bucket* and select an existing bucket from the drop down menu or click *New Bucket* to create a new user bucket.
.. If creating a new user bucket, a dialog box called _Create Bucket_ will appear where you can enter a bucket _Name_ and _Description_ and indicate if the bucket is _Staff Shareable?_. Click *Create Bucket*.
. After adding users to a bucket, an update will appear at the bottom-right hand corner of the screen that says _"Successfully added # users to bucket [Name]"_.

image::circulation_patron_records_web_client/userbucket1.PNG[Screenshot of the patron search page. The Add to Bucket and Merge Patrons buttons are inbetween the search fields above and the search results below.]

image::circulation_patron_records_web_client/userbucket2.PNG[Screenshot of the Create Bucket modal. There are Name and description fields and a checkbox for Staff Shareable?]

*To add users to a bucket by scanning user barcodes in the User Bucket interface:*

. Go to *Circulation->User Buckets* and select the *Pending Users* tab at the top of the screen.
. Click on *Buckets* and select an existing bucket from the drop down menu or click *New Bucket* to create a new user bucket.
.. If creating a new user bucket, a dialog box called _Create Bucket_ will appear where you can enter a bucket _Name_ and _Description_ and indicate if the bucket is _Staff Shareable?_. Click *Create Bucket*.
.. After selecting or creating a bucket, the Name, Description, number of items, and creation date of the bucket will appear above the _Scan Card_ field.
. Scan in the barcodes of the users that you want to add to the selected bucket into the _Scan Card_ field. Each user account will be added to the Pending Users tab. Hit ENTER on your keyboard after manually typing in a barcode to add it to the list of Pending Users.
. Select the user accounts that you want to add to the bucket by checking the box next to each user row or by using the CTRL or SHIFT key on your keyboard to select multiple users.
. Go to *Actions->Add To Bucket* or right-click on a selected user account to view the _Actions_ menu and select *Add To Bucket*. The user accounts will move to the Bucket View tab and are now in the selected User Bucket.

image::circulation_patron_records_web_client/userbucket3.PNG[Screenshot of the User bucket interface as described above. The tab options are Pending Users () and Bucket View (). The options to add users are next on the screen, The bucket selection button is inline with the grid actions buttons. The pending users tab and the add users sections are highlighted.]

*To add users to a bucket by uploading a file of user barcodes:*

. Go to *Circulation->User Buckets* and select the *Pending Users* tab at the top of the screen.
. Click on *Buckets* and select an existing bucket from the drop down menu or click *New Bucket* to create a new user bucket.
.. If creating a new user bucket, a dialog box called _Create Bucket_ will appear where you can enter a bucket _Name_ and _Description_ and indicate if the bucket is _Staff Shareable?_. Click *Create Bucket*.
.. After selecting or creating a bucket, the Name, Description, number of items, and creation date of the bucket will appear above the Scan Card field.
. In the Pending Users tab, click *Choose File* and select the file of barcodes to be uploaded.
.. The file that is uploaded must be a .txt file that contains a single barcode per row.
. The user accounts will automatically appear in the list of Pending Users.
. Select the user accounts that you want to add to the bucket by checking the box next to each user row or by using the CTRL or SHIFT key on your keyboard to select multiple users.
. Go to *Actions->Add To Bucket* or right-click on a selected user account to view the _Actions_ menu and select *Add To Bucket*. The user accounts will move to the Bucket View tab and are now in the selected User Bucket.

=== Batch Edit All Users ===

To batch edit all users in a user bucket:

. Go to *Circulation->User Buckets* and select the *Bucket View* tab.
. Click *Buckets* and select the bucket you want to modify from the list of existing buckets.
.. After selecting a bucket, the Name, Description, number of items, and creation date of the bucket will appear at the top of the screen.
. Verify the list of users in the bucket and click *Batch edit all users*. A dialog box called _Update all users_ will appear where you can select the batch modifications to be made to the user accounts.
. Assign a _Name for edit set_. This name will allow staff to identify the batch edit for future verification or rollbacks.
. Set the values that you want to modify. The following fields can be modified in batch:

* Home Library
* Profile Group
* Network Access Level
* Barred flag
* Active flag
* Juvenile flag
* Privilege Expiration Date

. Click *Apply Changes*. The modification(s) will be applied in batch.

image::circulation_patron_records_web_client/userbucket4.PNG[Screenshot of the Update all users modal. The fields are as described above. Two fields have been changed and these are indicated by green highlights.]

=== Batch Modify Statistical Categories ===

To batch modify statistical categories for all users in a bucket:

. Go to *Circulation->User Buckets* and select the *Bucket View* tab.
. Click *Buckets* and select the bucket you want to modify from the list of existing buckets.
.. After selecting a bucket, the Name, Description, number of items, and creation date of the bucket will appear at the top of the screen.
. Verify the list of users in the bucket and click *Batch modify statistical categories*. A dialog box called _Update statistical categories_ will appear where you can select the batch modifications to be made to the user accounts. The existing patron statistical categories will be listed and staff can choose:
.. To leave the stat cat value unchanged in the patron accounts.
.. To select a new stat cat value for the patron accounts.
.. Check the box next to Remove to delete the current stat cat value from the patron accounts.
. Click *Apply Changes*. The stat cat modification(s) will be applied in batch.

image::circulation_patron_records_web_client/userbucket12.PNG[screenshot of the Update statistical categories screen as described above.]

=== Batch Delete Users ===

To batch delete users in a bucket:
. Go to *Circulation->User Buckets* and select the *Bucket View* tab.
. Click on *Buckets* and select the bucket you want to modify from the list of existing buckets.
.. After selecting a bucket, the Name, Description, number of items, and creation date of the bucket will appear at the top of the screen.
. Verify the list of users in the bucket and click *Delete all users*. A dialog box called _Delete all users_ will appear.
. Assign a _Name for delete set_. This name will allow staff to identify the batch deletion for future verification or rollbacks.
. Click *Apply Changes*. All users in the bucket will be marked as deleted.

NOTE: Batch deleting patrons from a user bucket does not use the Purge User functionality, but instead marks the users as deleted.

image::circulation_patron_records_web_client/userbucket7.PNG[Screenshot of the Delete all users modal. Text has been entered in the name field and the field is now highlighted green.]

=== View Batch Changes ===

. The batch changes that have been made to User Buckets can be viewed by going to *Circulation->User Buckets* and selecting the *Bucket View* tab.
. Click *Buckets* to select an existing bucket.
. Click *View batch changes*. A dialog box will appear that lists the _Name_, date _Completed_, and date _Rolled back_ of any batch changes made to the bucket. There is also an option to _Delete_ a batch change. This will remove this batch change from the list of actions that can be rolled back. It will not delete or reverse the batch change.
. Click *OK* to close the dialog box.

image::circulation_patron_records_web_client/userbucket8.PNG[Screenshot of the View batch Changes modal as described above.]

=== Roll Back Batch Changes ===

. Batch Changes and Batch Deletions can be rolled back or reversed by going to *Circulation->User Buckets* and selecting the *Bucket View* tab.
. Click *Buckets* to select an existing bucket.
. Click *Roll back batch edit*. A dialog box will appear that contains a drop down menu that lists all batch edits that can be rolled back. Select the batch edit to roll back and click *Roll Back Changes*. The batch change will be reversed and the roll back is recorded under _View batch changes_.

NOTE: Batch statistical category changes cannot be rolled back.

image::circulation_patron_records_web_client/userbucket10.png[Screenshot of the Roll back batch edit modal. The dropdown menu is opened to show two options. "--- Select edit to roll back ---" and "deletion 3/12/2017"]

image::circulation_patron_records_web_client/userbucket9.PNG[Screenshot of the View batch Changes modal. A new date has been added to the Rolled back column.]

=== Sharing Buckets ===
If a User Bucket has been made Staff Shareable, it can be retrieved via bucket ID by another staff account. The ID for each bucket can be found at the end of the URL for the bucket. For example, in the screenshot below, the bucket ID is 32.

image::circulation_patron_records_web_client/userbucket11.PNG[Screenshog of the Bucket view page showing the URL bar at the top of the screen. The URL is "dev-test2.esilibrary.com/eg/staff/circ/patron/bucket/view/32"]

A shared bucket can be retrieved by going to *Circulation->User Buckets* and selecting the *Bucket View* tab. Next, click *Buckets* and select *Shared Bucket*. A dialog box called _Load Shared Bucket by Bucket ID_ will appear. Enter the ID of the bucket you wish to retrieve and click *Load Bucket*. The shared bucket will load in the Bucket View tab.

=== Permissions ===

All permissions must be granted at the organizational unit that the workstation is registered to or higher and are checked against the users' Home Library at when a batch modification or deletion is executed.

Permissions for Batch Edits:

* To batch edit a user bucket, staff accounts must have the VIEW_USER, UPDATE_USER, and CONTAINER_BATCH_UPDATE permissions for all users in the bucket.
* To make a batch changes to Profile Group, staff accounts must have the appropriate group application permissions for the profile groups.
* To make batch changes to the Home Library, staff accounts must have the UPDATE_USER permission at both the old and new Home Library.
* To make batch changes to the Barred Flag, staff accounts must have the appropriate BAR_PATRON or UNBAR_PATRON permission.

Permissions for Batch Deletion:

* To batch delete users in a user bucket, staff accounts must have the UPDATE_USER and DELETE_USER permissions for all users in the bucket.

